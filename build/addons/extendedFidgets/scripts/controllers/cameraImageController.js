function cameraImageCtrl(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){w&&o.cancel(w),w=o(c.startCamera,2e3)}function q(a,b){var c=window.setTimeout(function(){b(!1)},5e3),d=new Image;d.onload=function(){window.clearTimeout(c),b(!0)},d.onerror=function(){window.clearTimeout(c),b(!1)},d.src=a}function r(){var a=s.canvas,b=!1;if("stretch"==c.fidget.properties.scale)try{s.drawImage(u,0,0,u.width,u.height,0,0,a.width,a.height),b=!0}catch(d){throw c.stopCamera(),d}else{var e=a.width/u.width,f=a.height/u.height,g="aspectFit"==c.fidget.properties.scale?Math.min(e,f):Math.max(e,f),h=(a.width-u.width*g)/2,i=(a.height-u.height*g)/2;try{s.drawImage(u,0,0,u.width,u.height,h,i,u.width*g,u.height*g),b=!0}catch(d){throw c.stopCamera(),d}}b&&c.enabled&&(c.connected=!0,c.startCamera())}var s,t,u,v,w;c.connected=!1,c.currentFidget=null,c.loggedInUrl=null,c.enabled=!0,c.$on("$destroy",function(){c.deleted=!0}),c.startCamera=function(){c.deleted||(v&&o.cancel(v),c.enabled=!0,v=o(function(){try{r()}catch(a){console.log("Camera error",a),c.connected=!1,p()}},100))},c.stopCamera=function(){c.enabled=!1,c.connected=!1},c.$watch(function(){return l.loaded},function(){c.fidget&&c.initCameraImage(l.getFidgetById(c.fidget.id))}),c.initCameraImage=function(a){c.fidget=a,o(function(){t=document.getElementById("player_"+a.id),s=t.getContext("2d"),c.$watch(function(){return a.properties.source},function(){q(a.properties.source,function(b){console.log(a.properties.source,b),b?(u=new Image,u.onload=c.startCamera(),u.src=a.properties.source):(c.stopCamera(),o.cancel(w))})}),c.$watchGroup([function(){return a.properties.width},function(){return a.properties.height},function(){return a.properties.source},function(){return a.properties.scale}],function(){t.width=a.properties.width,t.height=a.properties.height,t.style.width=a.properties.width+"px",t.style.height=a.properties.height+"px";var b=t.getContext("2d");b.clearRect(0,0,t.width,t.height)})},1e3)}}cameraImageCtrl.$inject=["$http","$sce","$scope","$window","$location","$routeParams","$attrs","editorService","popupService","deviceService","scriptManagerService","projectService","variableService","settingsWindowService","$timeout"];