function wizardService(a,b,c,d,e,f,g,h,i,j){j.setVariable=function(a,b){j.modes[j.mode].setVariable(a,b)},j.getVariable=function(a,b){return j.modes[j.mode].getVariable(a,b)},j.modes.rosparam.setVariable=function(a,b){h.callService("/rosapi/set_param",{name:a,value:JSON.stringify(b)},function(a){})},j.modes.rosparam.getVariable=function(a,b){"rosparam"==j.mode&&(h.callService("/rosapi/get_param",{name:a},function(a){var c=JSON.parse(a.value);b&&b(c)}),setTimeout(function(){j.modes.rosparam.getVariable(a,b)},1e3))},j.modes.localStorage.setVariable=function(a,b){localStorage.setItem("userVariable_"+a,b)},j.modes.localStorage.getVariable=function(a,b){if(b){var c=localStorage.getItem("userVariable_"+a);b(c)}};var l={isVisible:!1,templates:{},run:{},currentTemplate:null,currentEditor:null,isValid:!1,connectorVariableLocals:[],customFunctions:[],setVisible:function(a,b){l.isVisible=a,l.currentEditor=b,l.currentTemplate=null,a&&(l.changeScreenOptionsRefresh(),l.connectorVariableNodes(),l.listOfCustomFunctions())},insertTemplate:function(){l.isValid=!0,angular.forEach(l.currentTemplate.params,function(a){a.valid||(l.isValid=!1)}),l.isValid&&(l.currentEditor.session.insert(l.currentEditor.getCursorPosition(),l.currentTemplate.getScript()),l.isVisible=!1)},addTemplate:function(b,c,d,e){l.templates[b]={params:c,action:d,help:localization.currentLocal.wizard.templates[b].help,label:localization.currentLocal.wizard.templates[b].title,name:b},a.addScriptReplace("#"+b,"$rootScope.wizard.run."+b),l.templates[b].getScript=function(){var a=[];angular.forEach(l.currentTemplate.params,function(b){switch([null,"null",void 0,"undefined"].indexOf(b)>-1&&a.push(null),b.type){case"number":a.push(b.value);break;case"script":a.push("function( "+b.paramsToPass+" ){\n"+b.value+"\n}");break;default:a.push("'"+b.value+"'")}});var b="#"+l.currentTemplate.name+"( "+a.join(", ")+" );\n";return b},l.run[b]=l.templates[b].action},checkValid:function(){return l.isValid=!0,angular.forEach(l.currentTemplate.params,function(a){a.valid||(l.isValid=!1)}),l.isValid}};return l.addTemplate("createTopic",[{name:"name",type:"text",value:"",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!1},{name:"type",type:"text",value:"std_msgs/String",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!0},{name:"subscribe",type:"dropdown",options:["False","True"],value:"True",onChange:function(){},valid:!0},{name:"friendlyName",type:"text",value:"",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!1},{name:"onChange",value:"	/* This script will be copied to the topic's On Change parameter */\n	",type:"script",paramsToPass:[],hidden:!0,onChange:function(){},valid:!0}],function(a,b,d,f,g){var j="/wizard/"+a,k=new ROSLIB.Topic({name:j,messageType:b,ros:c.ros});k.ros=c.ros,k.advertise();var l=6e4,m=function(){if(0>l);else if(void 0==h.nodes.wizard||void 0==h.nodes.wizard[a])setTimeout(m,1e3),l-=1e3;else{h.nodes.wizard[a].subscribed=["True","true","on",1].indexOf(d)>-1,h.nodes.wizard[a].friendlyName=f,h.updateFriendlyCache();var b="/*\n";b+="This script is generated by a wizard called 'createTopic'\n",b+="That function might overwrite any changes made here!\n",b+="*/\n",b+="\n",b+="var onChangeFunction = "+g,b+="\n",b+="onChangeFunction();\n",e(function(){i.interfaceMetaData.setOnChangeScript(j,b)},100,!0)}};m()}),l.changeScreenOptionsRefresh=function(){l.templates.changeScreen.params[0].options=[],l.templates.connectorVariable.params[0].value="";for(var a=0;a<i.screens.length;a++)l.templates.changeScreen.params[0].options[a]=i.screens[a].properties.name},l.addTemplate("changeScreen",[{name:"screen",type:"dropdown",options:[],value:"",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!1}],function(a){for(var b=!1,c=0;c<i.screens.length;c++)if(i.screens[c].properties.name==a){d.path(a),b=!0;break}b||f.show(localization.currentLocal.wizard.templates.changeScreen.error+a,f.types.error)}),l.connectorVariableNodes=function(){l.templates.connectorVariable.params[0].options=[],l.templates.connectorVariable.params[0].value="",l.templates.getConnectorVariable.params[0].options=[],l.templates.getConnectorVariable.params[0].value="",l.templates.setConnectorVariable.params[0].options=[],l.templates.setConnectorVariable.params[0].value="",l.templates.getReadyConnectorVariable.params[0].options=[],l.templates.getReadyConnectorVariable.params[0].value="",l.templates.callService.params[0].options=[],l.templates.callService.params[0].value="";var a=0,b=0;for(n in h.nodes)l.templates.callService.params[0].options[a]=n,void 0!=h.nodes[n].Variables&&(l.templates.connectorVariable.params[0].options[b]=n,l.templates.getConnectorVariable.params[0].options[b]=n,l.templates.setConnectorVariable.params[0].options[b]=n,l.templates.getReadyConnectorVariable.params[0].options[b]=n,b++),a++},l.connectorVariableVariables=function(a){h.nodes[a].Variables.call({},function(a){e(function(){l.currentTemplate.params[1].options=[];for(var b=0;b<a.variables.length;b++)l.currentTemplate.params[1].options.push(a.variables[b])},0,!0)})},l.addTemplate("connectorVariable",[{name:"node",type:"dropdown",options:[],value:"",onChange:function(){""==this.value?this.valid=!1:(this.valid=!0,l.currentTemplate.params[1].value="",l.connectorVariableVariables(this.value)),l.checkValid()},valid:!1},{name:"variable",type:"dropdown",options:[],value:"",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!1},{name:"friendlyName",type:"text",value:"",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!1}],function(a,b,c){var d="/"+a+"/Variables/"+b,e=function(){var c=6e4,e=function(){0>c||(void 0==h.nodes[a]||void 0==h.nodes[a]["Variables/"+b]?(setTimeout(e,1e3),c-=1e3):(h.nodes[a]["Variables/"+b].subscribed=!0,null!=h.nodes[a]["Variables/"+b].value&&(l.connectorVariableLocals[d]=h.nodes[a]["Variables/"+b].value.value)))};e()},f=function(){h.nodes[a]["Variables/"+b].friendlyName=c,h.updateFriendlyCache();var e="/*\n";e+="This script is generated by a wizard called 'connectorVariable'\n",e+="Do not change it!\n",e+="*/\n",e+="\n",e+="// WARNING! This script works only for String messages!\n",e+="#connectorVariableLocals['"+d+"'] = ",e+="@"+c+".value.value;\n",i.changeScripts[d]=e,console.log(i.changeScripts)};if(void 0==h.nodes[a]||void 0==h.nodes[a]["Variables/"+b]||1!=h.nodes[a]["Variables/"+b].subscribed){var g=6e4,j=function(){0>g||(void 0==h.nodes[a]||void 0==h.nodes[a].Variables?(setTimeout(j,1e3),g-=1e3):h.nodes[a].Variables.call({},function(c){-1==c.variables.indexOf(b)||h.nodes[a].Subscribe.call({variable_name:b},function(a){e(),f()})}))};j()}else f()}),l.addTemplate("getConnectorVariable",[{name:"node",type:"dropdown",options:[],value:"",onChange:function(){""==this.value?this.valid=!1:(this.valid=!0,l.currentTemplate.params[1].value="",l.connectorVariableVariables(this.value)),l.checkValid()},valid:!1},{name:"variable",type:"dropdown",options:[],value:"",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!1}],function(a,b){var c="/"+a+"/Variables/"+b;return l.connectorVariableLocals[c]}),angular.forEach(Object.keys(localization.items),function(a){localization.items[a].wizard.templates.getPredefinedVariable={title:"Get predefined variable",help:"Use this wizard to get a predefined variable by its name",params:{name:"Name"}},localization.items[a].wizard.templates.setPredefinedVariable={title:"Set predefined variable",help:"Use this wizard to set a predefined variable by its name",params:{name:"Name",value:"Value"}},localization.items[a].wizard.templates.defineVariable={title:"Define variable",help:"Use this wizard to define custom variables in a global storage",params:{setterFunction:"Setter for the value",getterFunction:"Getter for the value",isPersistent:"Persistent",defaultValue:"Default value",name:"Name"}}}),l.addTemplate("getPredefinedVariable",[{name:"name",type:"text",otpions:[],value:"",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!1}],function(a){return c.userDefined[a]}),b.$watch(function(){return Object.keys(c.userDefined).length},function(){var a=[];angular.forEach(Object.keys(c.userDefined),function(b){0==b.indexOf("_")&&a.push(b.substring(1))}),l.templates.getPredefinedVariable.params[0].options=a,l.templates.setPredefinedVariable.params[0].options=a}),l.addTemplate("setPredefinedVariable",[{name:"name",type:"text",otpions:[],value:"",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!1},{name:"value",type:"text",value:"",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!1}],function(a,b){c.userDefined[a]=b}),l.addTemplate("defineVariable",[{name:"name",type:"text",value:"",onChange:function(){""==this.value||"_"+name in c.userDefined||!c.isFriendlyNameValid(this.value)?this.valid=!1:this.valid=!0,l.checkValid(),this.valid&&(l.currentTemplate.params[3].value="   /* Add a script here how to get your variable. */\n	return variableService.userDefined['_"+this.value+"'];",l.currentTemplate.params[4].value="	/* Add a script here how to set your variable. */\n	variableService.userDefined['_"+this.value+"'] = newValue;")},valid:!1},{name:"defaultValue",type:"text",value:"",onChange:function(){this.valid=!0,l.checkValid()},valid:!0},{name:"isPersistent",type:"text",value:!0,onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!0},{name:"getterFunction",type:"script",paramsToPass:[],hidden:!0,isDefault:!0,value:"	/* Add a script here how to get your variable. */\n	return variableService.userDefined['_"+name+"'];",onChange:function(){},valid:!0},{name:"setterFunction",type:"script",paramsToPass:["newValue"],hidden:!0,value:"	/* Add a script here how to set your variable. */\n	variableService.userDefined['_"+name+"'] = newValue;",onChange:function(){},valid:!0}],function(a,b,d,e,f){c.userDefined["_"+a]=b,d=Boolean(d),Object.defineProperty(c.userDefined,a,{enumerable:!0,configurable:!0,get:e,set:function(b){f&&f(b),d&&j.setVariable(a,b)}}),c.addFriendlyName(a,c.userDefined[a]),d&&j.getVariable(a,function(b){b&&(c.userDefined[a]=b)})}),l.addTemplate("setConnectorVariable",[{name:"node",type:"dropdown",options:[],value:"",onChange:function(){""==this.value?this.valid=!1:(this.valid=!0,l.currentTemplate.params[1].value="",l.connectorVariableVariables(this.value)),l.checkValid()},valid:!1},{name:"variable",type:"dropdown",options:[],value:"",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!1},{name:"value",type:"text",value:"",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!1},{name:"operation",type:"dropdown",options:["=","+=","*="],value:"=",onChange:function(){},valid:!0}],function(a,b,c,d){var e="/"+a+"/Variables/"+b;if(l.connectorVariableLocals[e]==h.nodes[a]["Variables/"+b].value.value){var f=l.connectorVariableLocals[e],g=0;0==isNaN(c)&&(g=Number(c));var i=0;switch(0==isNaN(l.connectorVariableLocals[e])&&(i=Number(l.connectorVariableLocals[e])),d){case"+=":i+=g;break;case"*=":i*=g;break;default:i=g}l.connectorVariableLocals[e]=i.toString(),h.nodes[a].ChangeVariable.call({name:b,value:i.toString()},function(a){""!=a.fail_reason&&(l.connectorVariableLocals[e]=f)})}}),l.addTemplate("getReadyConnectorVariable",[{name:"node",type:"dropdown",options:[],value:"",onChange:function(){""==this.value?this.valid=!1:(this.valid=!0,l.currentTemplate.params[1].value="",l.connectorVariableVariables(this.value)),l.checkValid()},valid:!1},{name:"variable",type:"dropdown",options:[],value:"",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!1}],function(a,b){var c="/"+a+"/Variables/"+b;return l.connectorVariableLocals[c]==h.nodes[a]["Variables/"+b].value.value}),l.addTemplate("autoDefine",[{name:"variable",type:"text",value:"",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!1},{name:"value",type:"text",value:"",onChange:function(){},valid:!0}],function(a,b){scriptManager.autoInit(a,b)}),l.addTemplate("popup",[{name:"message",type:"text",value:"",onChange:function(){},valid:!0},{name:"type",type:"dropdown",options:["info","warning","error"],value:"info",onChange:function(){},valid:!0}],function(a,b){var c;switch(b){case"warning":c=f.types.warning;break;case"error":c=f.types.error;break;default:c=f.types.info}f.show(a,c)}),l.addTemplate("timeout",[{name:"timeout",type:"number",value:"1000",onChange:function(){isNaN(this.value)||""==this.value||this.value<=0?this.valid=!1:this.valid=!0,l.checkValid()},valid:!0},{name:"fn",type:"script",paramsToPass:[],hidden:!0,value:"	/* Add a script here that you want to delay */\n	",onChange:function(){},valid:!0},{name:"name",type:"text",paramsToPass:[],hidden:!1,value:"",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!1}],function(a,b,c){c&&l.timers[c]&&(e.cancel(l.timers[c]),delete l.timers[c]),c?l.timers[c]=e(b,a,!0):e(b,a,!0)}),l.timers={},l.findCustomFunction=function(a){for(var b=-1,c=0;c<l.customFunctions.length;c++)if(l.customFunctions[c].name==a){b=c;break}return b},l.addTemplate("setFunction",[{name:"name",type:"text",value:"",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!1},{name:"fn",type:"script",paramsToPass:[],hidden:!0,value:"	/* Put script here to save it as function */\n	",onChange:function(){},valid:!0}],function(a,b){var c=l.findCustomFunction(a),d={};-1!=c&&(d=l.customFunctions[c]),d.name=a,d.fn=b,-1==c&&l.customFunctions.push(d)}),l.listOfCustomFunctions=function(){l.templates.callFunction.params[0].options=[];for(var a=0;a<l.customFunctions.length;a++)l.templates.callFunction.params[0].options[a]=l.customFunctions[a].name},l.addTemplate("publishTopic",[{name:"path",type:"text",value:"/myNodeName/myTopicName",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!0},{name:"value",type:"text",value:'{"data": "myValue"}',onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!0},{name:"type",type:"text",value:"std_msgs/String",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!0}],function(a,d,e){var f=null;if(angular.forEach(h.topics,function(b){b.path==a&&!b.isOffline&&b.listener&&(f=b)}),f)f.listener.publish(JSON.parse(d));else{var g=new ROSLIB.Topic({name:a,messageType:e,ros:c.ros});g.ros=c.ros,g.advertise(),h.updateRos();var i=b.$watch(function(){return h.rosUpdated},function(){var b=null;angular.forEach(h.topics,function(c){c.path!=a||c.isOffline||(b=c)}),b&&(i(),b.subscribed=!0,b.listener.publish(JSON.parse(d)))})}}),l.addTemplate("callFunction",[{name:"name",type:"dropdown",options:[],value:"",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!1}],function(a){var b=l.findCustomFunction(a);-1==b?f.show(localization.currentLocal.wizard.templates.callFunction.error+a,f.types.error):l.customFunctions[b].fn()}),l.connectorVariableFunctions=function(a){var b=a;l.currentTemplate.params[1].options=[];for(k in h.nodes[b])h.nodes[b][k].isService&&l.currentTemplate.params[1].options.push(h.nodes[b][k].shortPath)},l.addTemplate("callService",[{name:"node",type:"dropdown",options:[],value:"",onChange:function(){""==this.value?this.valid=!1:(this.valid=!0,l.currentTemplate.params[1].value="",l.connectorVariableFunctions(this.value)),l.checkValid()},valid:!1},{name:"service",type:"dropdown",options:[],value:"",onChange:function(){""==this.value?this.valid=!1:this.valid=!0,l.checkValid()},valid:!1},{name:"parameter",type:"number",hidden:!0,value:"{/* Put parameters here */}",onChange:function(){},valid:!0},{name:"callback",type:"script",paramsToPass:["result"],hidden:!0,value:'	/* The service will call back the following script: */\n	#popup( result, "info" );',onChange:function(){},valid:!0}],function(a,b,c,d){var e=6e4,f=function(){0>e||(void 0==h.nodes[a]||void 0==h.nodes[a][b]?(setTimeout(f,1e3),e-=1e3):h.nodes[a][b].call(c,d))};f()}),b.addModal("wizardsWindow",g.trustAsResourceUrl(b.addonServerUrl+"addons/templateWizard/views/wizardsWindow.html"),"$rootScope.wizard.isVisible"),b.scriptEditorExtras||(b.scriptEditorExtras=[]),b.scriptEditorExtras.push(g.trustAsResourceUrl(b.addonServerUrl+"addons/templateWizard/views/properties/wizardTemplateButton.html")),l}wizardService.$inject=["scriptManagerService","$rootScope","variableService","$location","$timeout","popupService","$sce","deviceService","projectService","projectStorageService"];