function timerService($sce,$rootScope,$timeout,projectService,settingsWindowService,helpService,variableService,deviceService,popupService,scriptManagerService,projectStorageService){var srv={createTimer:function(a,b,c,d){var e={name:a,delay:b,action:d,repeat:c,__pointer:null,__id:variableService.guid()};return this.initTimer(e),e},initTimer:function(a){a.start=function(){srv.startTimer(a)},a.stop=function(){srv.stopTimer(a)},variableService.friendlyCache[a.name]=a},getTimer:function(a){var b=null;return angular.forEach(projectService.timers,function(c){c.name==a&&(b=c)}),b},startTimer:function(t){return t.pointer?void popupService.show(localization.currentLocal.timers.alreadyRunningError):(Object.defineProperty(t,"pointer",{configurable:!0,get:function(){return this.__pointer},set:function(a){this.__pointer=a}}),t.pointer=$timeout(function(){try{eval(scriptManagerService.compile(t.action))}catch(e){console.log(t.action)}t.repeat&&projectService.timers[t.__id]?(t.__pointer=null,srv.startTimer(t)):$rootScope.$apply(function(){delete t.pointer,t.__pointer=null})},t.delay,!0),void projectStorageService.save(!1))},stopTimer:function(a){a.pointer&&($timeout.cancel(a.pointer),delete a.pointer,a.__pointer=null),projectStorageService.save(!1)},removeTimer:function(a){a.pointer&&timers.stopTimer(a),delete variableService.friendlyCache[a.name],delete projectService.timers[a.__id]},changeTimerState:function(a){a.pointer?this.stopTimer(a):this.startTimer(a)},editorVisible:!1,currentTimer:null,originalTimer:null,setEditorVisible:function(a,b){a?b?(this.currentTimer=angular.copy(b),this.originalTimer=b):this.currentTimer=this.createTimer("",1e3,!1,"/* Put your code here */"):(delete this.currentTimer,delete this.originalTimer,delete $rootScope.currentEditor),this.editorVisible=a},disableAll:function(){angular.forEach(projectService.timers,function(a){srv.stopTimer(a)}),projectStorageService.save(!1)},hasInvalidParam:function(){return variableService.isFriendlyNameValid(this.currentTimer.name)?this.currentTimer.delay<30?!0:[void 0,null,""].indexOf(this.currentTimer.name)>-1?!0:!1:!0},saveTimer:function(){var canSave=!0;try{eval(scriptManagerService.compile(this.currentTimer.action))}catch(e){popupService.show(e.message,popupService.types.error),canSave=!1}variableService.friendlyCache[this.currentTimer.name]&&variableService.friendlyCache[this.currentTimer.name].__id!=this.currentTimer.__id&&(canSave=!1,popupService.show(localization.currentLocal.settings.tabs.timers.duplicatedError,popupService.types.error)),canSave&&(this.originalTimer?(this.originalTimer.name!=this.currentTimer.name&&(delete variableService.friendlyCache[this.originalTimer.name],variableService.friendlyCache[this.currentTimer.name]=this.originalTimer),this.originalTimer.name=this.currentTimer.name,this.originalTimer.action=this.currentTimer.action,this.originalTimer.delay=this.currentTimer.delay,this.originalTimer.repeat=this.currentTimer.repeat):(projectService.timers[this.currentTimer.__id]=this.currentTimer,variableService.friendlyCache[this.currentTimer.name]=this.currentTimer),projectStorageService.save(!1),this.setEditorVisible(!1))},hasTimers:function(){return projectService.timers&&0!=Object.keys(projectService.timers).length}};return $rootScope.setTimerAction=function(a){a&&(srv.currentTimer.action=a.getSession().getDocument().getValue())},projectService.extraParamGetters.push(function(a){return a.timers=projectService.timers,a}),projectService.extraCleanParamGetters.push(function(a){return a.timers={},a}),projectService.extraParamSetters.push(function(a){projectService.timers={},angular.forEach(a.timers||{},function(a){projectService.timers[a.__id]||(projectService.timers[a.__id]=a,srv.initTimer(a),a.__pointer&&srv.startTimer(a))})}),helpService.settings.timers={"for":localization.currentLocal.help.timers.header,source:$rootScope.addonServerUrl+"addons/timers/views/help/timers.html"},$rootScope.addModal("timerEditorWindow",$sce.trustAsResourceUrl($rootScope.addonServerUrl+"addons/timers/views/timerEditorWindow.html"),"$rootScope.timers.editorVisible"),$rootScope.settingsTabs.timers={help:helpService.settings.timers,position:15,source:$rootScope.addonServerUrl+"addons/timers/views/settings/timers.html",title:localization.currentLocal.settings.tabs.timers.title,classes:"timersSettingsTab"},$rootScope.settingsTabs.addons.children.push($rootScope.settingsTabs.timers),srv}timerService.$inject=["$sce","$rootScope","$timeout","projectService","settingsWindowService","helpService","variableService","deviceService","popupService","scriptManagerService","projectStorageService"];