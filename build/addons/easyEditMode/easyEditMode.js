function easyEditModeService(a,b,c,d,e,f,g,h,i,j,k,l){return g.variableSelector={repeater:i.trustAsResourceUrl(g.addonServerUrl+"addons/easyEditMode/views/variableRepeater.html"),variables:null,currentProperty:null,originalValue:null,currentValue:null,isVisible:!1,itemSelected:function(){$(".perfectScrollBar").each(function(){$(this).perfectScrollbar("update")})},hide:function(b){b&&(a.editedFidget.properties[this.currentProperty]=this.currentValue),this.isVisible=!1},show:function(a,b){this.variables=j.getVariables([]),this.isVisible=!0,this.currentProperty=b,this.originalValue=a,this.currentValue=a},selectVariable:function(a){this.currentValue=a.path,this.currentSaveAction=a.onSave}},angular.forEach(Object.keys(localization.items),function(a){localization.items[a].variableSelector={title:"Variable selector",longtap:"Long tap to open variables"}}),localization.items.hu.variableSelector.title="Változók böngészése",localization.items.de.variableSelector.title="Variablenwähler",localization.items.ko.variableSelector.title="변수 선택기",localization.items.it.variableSelector.title="Selettore variabile",localization.items.hu.variableSelector.longtap="Hosszú érintés a változók megnyitásához",localization.items.de.variableSelector.longtap="Langes Antippen, um Variablen zu öffnen",localization.items.ko.variableSelector.longtap="변수를 열려면 길게 누르십시오",localization.items.it.variableSelector.longtap="Rubinetto a lungo per aprire variabili",g.$watch(function(){return a.propertiesWindowVisible},function(){a.propertiesWindowVisible&&h(function(){$("input",$("#propertiesDialog")).each(function(){$(this).hasClass("form-control-66")||"fidgetId"==$(this).attr("id")||$(this).after("<p style='margin-top: -34px; margin-right: 20px; line-height: 34px; margin-bottom: 0px; pointer-events: none; color: gray'>[ "+localization.currentLocal.variableSelector.longtap+" ]</p>")})},400)}),g.propertyPressed=function(b){g.variableSelector.show(a.editedFidget.properties[b],b)},g.addModal("variableSelectorWindow",i.trustAsResourceUrl(g.addonServerUrl+"addons/easyEditMode/views/variableSelector.html"),"$rootScope.variableSelector.isVisible"),a.modes.rotate={name:"Rotate",init:function(){a.actions.rotate=a.getAction(localization.currentLocal.editMode.rotate,a.modes.rotate.enable,g.addonServerUrl+"addons/easyEditMode/","images/rotate.png",c.screenTypesEnum.Factory),a.onResizeFidget=function(b,c){var d=a.getMousePos(c),e=a.selectedFidgets[0],f=parseInt([null,void 0,"undefined","NaN"].indexOf(e.properties.angle)>-1?0:e.properties.angle);e.originalBoundingBox=j.fitRect(a.getFidgetSize(e),f*Math.PI/180),e.posBeforeDrag={top:e.properties.top,left:e.properties.left,_top:e.properties._top,_left:e.properties._left},a.mouseDownPos=d,a.fidgetCorner=b,a.inResize=!0}},onMouseDown:function(a,b){},onMouseMove:function(b,c){for(var d=0;d<a.selectedFidgets.length;d++){var e=a.selectedFidgets[d];if("undefined"!==e.properties._angle){var f=a.mouseDownPos.x-a.getMousePos(c).x+a.beltWidth||0,g=j.fitRect(a.getFidgetSize(e),e.properties._angle*Math.PI/180);e.properties._angle=(a.selectedFidgets[d].properties.angle-f)%360;var h=j.fitRect(a.getFidgetSize(e),e.properties._angle*Math.PI/180);e.properties.top-=(h.height-g.height)/2,e.properties.left-=(h.width-g.width)/2}}a.mouseDownPos=a.getMousePos(c)},onMouseUp:function(b,c){l.save(!0),a.isMouseDown=!1,delete a.activeContainer},enable:function(){a.currentMode==a.modes.rotate?(a.actions.rotate.sticked=!1,a.currentMode=null):(a.isMultiSelect=!1,a.currentMode=a.modes.rotate,a.actions.rotate.sticked=!0,a.actions.select.enabled=0==a.isMultiSelect)},onGetFidgets:function(a,b,c,d){},onEditModelChanged:function(d,e){var f=!1;angular.forEach(a.selectedFidgets,function(a){-1!==Object.keys(a.template.properties).indexOf("_angle")&&b.currentScreen.type==c.screenTypesEnum.Factory&&(f=!0)}),f||a.modes.rotate!=a.currentMode||(a.currentMode=null,a.modes.move.enable()),a.actions.rotate.enabled=f,a.actions.rotate.sticked=a.modes.rotate==a.currentMode},showBeltOverlayes:!1},a.modes.resize={name:"Resize",init:function(){a.actions.resize=a.getAction(localization.currentLocal.editMode.resize,a.modes.resize.enable,g.addonServerUrl+"addons/easyEditMode/","images/resize.png")},onMouseDown:function(a,b){},onMouseMove:function(b,d){function e(a,b,c){c=[null,void 0,"undefined","NaN"].indexOf(c)>-1?0:c;var d=c*Math.PI/180,e=Math.cos(d)*a+Math.sin(d)*b,f=Math.cos(d)*b-Math.sin(d)*a;return{x:parseInt(e),y:parseInt(f)}}if(a.isDragging||-1!=[null,void 0].indexOf(a.fidgetCorner))return a.modes.move.onMouseMove(b,d),void(this.showBeltOverlayes=!0);var f=a.getMousePos(d),g=a.selectedFidgets[0],h={x:f.x-a.mouseDownPos.x,y:f.y-a.mouseDownPos.y};switch(a.fidgetCorner){case c.dragCorner.topLeft:h.y=-1*h.y,h.x=-1*h.x;break;case c.dragCorner.topRight:h.y=-1*h.y;break;case c.dragCorner.bottomLeft:h.x=-1*h.x}var i=!0,j=!0;-h.x>=g.originalBoundingBox.width-1&&(j=!1),-h.y>=g.originalBoundingBox.height-1&&(i=!1);var k=j?parseInt(g.originalBoundingBox.width+h.x):1,l=i?parseInt(g.originalBoundingBox.height+h.y):1,m=k,n=l,o=parseInt([null,void 0,"undefined","NaN"].indexOf(g.properties.angle)>-1?0:g.properties.angle)%180;if(o%90!=0){o%90>40&&50>o%90&&(o=30),o>90?o-=90:90>o&&(o=90-o);var p=o*Math.PI/180,q=Math.cos(p),r=Math.sin(p),n=(l*r-k*q)/(r*r-q*q),m=(k-n*q)/r}else{var s=e(m,n,o);n=Math.abs(s.y),m=Math.abs(s.x)}i=i&&!(1==g.properties.height&&1==Math.max(parseInt(n),1)),j=j&&!(1==g.properties.width&&1==Math.max(parseInt(m),1));angular.element("#"+g.id).scope();switch(i&&(g.properties.height=Math.max(parseInt(n),1)),j&&(g.properties.width=Math.max(parseInt(m),1)),a.fidgetCorner){case c.dragCorner.topLeft:i&&(g.properties.top=g.posBeforeDrag.top-h.y),j&&(g.properties.left=g.posBeforeDrag.left-h.x);break;case c.dragCorner.topRight:i&&(g.properties.top=g.posBeforeDrag.top-h.y);break;case c.dragCorner.bottomLeft:j&&(g.properties.left=g.posBeforeDrag.left-h.x)}},onMouseUp:function(b,c){return null==a.fidgetCorner||void 0==a.fidgetCorner?(a.modes.move.onMouseUp(b,c),void(this.showBeltOverlayes=!1)):(l.save(!0),a.isMouseDown=!1,a.inResize=!1,delete a.fidgetCorner,void delete a.activeContainer)},enable:function(){a.currentMode==a.modes.resize?(a.actions.resize.sticked=!1,a.currentMode=null):(a.currentMode=a.modes.resize,a.actions.resize.sticked=!0,a.isMultiSelect=!1,a.selectedFidgets.length>1&&(a.selectedFidgets=[a.selectedFidgets.pop()]))},onGetFidgets:function(d,e,f,g){if(a.modes.resize==a.currentMode&&1==a.selectedFidgets.length&&!a.isDragging){var h=a.selectedFidgets[0],i=h.parent,k=j.fitRect(a.getFidgetSize(h),(h.properties.angle||0)*Math.PI/180);for(h.absoluteOffset={top:h.properties.top,left:h.properties.left};i&&i!=b.currentScreen;)h.absoluteOffset.top+=i.properties.top,h.absoluteOffset.left+=i.properties.left,i=i.parent;for(var l=({x:h.absoluteOffset.left+k.width/2,y:h.absoluteOffset.top+k.height/2},0);4>l;l++){var m={left:h.absoluteOffset.left-50,top:h.absoluteOffset.top-50,name:c.dragCorner.topLeft};switch(l){case 0:break;case 1:m.left+=50+k.width,m.name=c.dragCorner.topRight;break;case 2:m.top+=50+k.height,m.name=c.dragCorner.bottomLeft;break;case 3:m.left+=50+k.width,m.top+=50+k.height,m.name=c.dragCorner.bottomRight}if(m.left<=d.x&&m.left+50>=d.x&&m.top<=d.y&&m.top+50>=d.y)return a.inResize||a.onResizeFidget(m.name,e),h}}},onEditModelChanged:function(b,c){$(".resizeLayer").remove(),angular.forEach(a.selectedFidgets,function(b){if(a.currentMode==a.modes.resize){var c=angular.element("#"+b.id).scope();$("#"+b.id).append(k('<div class="resizeLayer" ng-if="editHandler.selectedFidgets[0] == fidget"><div class="resizeDot" style="top: 0px; left: 0px;"></div><div class="resizeDot" style="top: 0px; right: 0px;"></div><div class="resizeDot" style="bottom: 0px; left: 0px;"></div><div class="resizeDot" style="bottom: 0px; right: 0px;"></div></div>')(c))}}),a.actions.resize.sticked=a.modes.resize==a.currentMode},showBeltOverlayes:!1},a.modes.snapToGrid={name:"Snap to grid",onEditModelChanged:function(a,b){},onMouseDown:function(a){},onMouseUp:function(a){},onMouseMove:function(a){},disable:function(){},init:function(){a.setFidgetPosition=function(b,c){a.isGridEnabled?(b.properties.left=Math.round((b.posBeforeDrag.left-a.safetyDistance+c.x-a.mouseDownPos.x)/e.gridsize)*e.gridsize,b.properties.top=Math.round((b.posBeforeDrag.top+c.y-a.mouseDownPos.y)/e.gridsize)*e.gridsize):(b.properties.left=b.posBeforeDrag.left+c.x-a.mouseDownPos.x,b.properties.top=b.posBeforeDrag.top+c.y-a.mouseDownPos.y)},a.actions.grid=a.getAction(localization.currentLocal.editMode.snapToGrid,a.modes.snapToGrid.enable,g.addonServerUrl+"addons/easyEditMode/","images/grid.png"),a.grid={getRatioW:function(){var a=e.gridsize||1;return new Array(Math.ceil($(window).width()/a))},getRatioH:function(){var a=e.gridsize||1;return new Array(Math.ceil($(window).height()/a))}},a.grid.ratioW=a.grid.getRatioW(),a.grid.ratioH=a.grid.getRatioH(),$(window).resize(function(){h(function(){a.grid.ratioW=a.grid.getRatioW(),a.grid.ratioH=a.grid.getRatioH()})}),a.watchers.push(g.$watch(function(){return e.gridsize},function(){a.grid.ratioW=a.grid.getRatioW(),a.grid.ratioH=a.grid.getRatioH()})),f.templates.fidgetGroup.root=g.addonServerUrl+"addons/easyEditMode/views/fidgets/",e.addGeneralSetting(i.trustAsResourceUrl(g.addonServerUrl+"addons/easyEditMode/views/settings/general.html"),""),e.gridsize=parseInt(localStorage.getItem("gridSize")||50),e.storeGridSize=function(){localStorage.setItem("gridSize",e.gridsize||1)},g.screenRoot=i.trustAsResourceUrl(g.addonServerUrl+"addons/easyEditMode/views/screen.html"),a.isGridEnabled=!1},enable:function(){a.isGridEnabled=!a.isGridEnabled,a.actions.grid.sticked=a.isGridEnabled},showBeltOverlayes:!0},a.modes.resize.init(),a.modes.rotate.init(),a.modes.snapToGrid.init(),a.setPosition(a.actions.grid,a.actions.upload.position+1),a.setPosition(a.actions.resize,a.actions.upload.position+2),a.setPosition(a.actions.rotate,a.actions.upload.position+3),{}}easyEditModeService.$inject=["editorService","projectService","enumService","deviceService","settingsWindowService","fidgetService","$rootScope","$timeout","$sce","variableService","$compile","projectStorageService"];