function remoteViewCtrl(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){c.fidget.properties.onlyKeyboard?window.setTimeout(function(){p()},1e3/u):q(w+"/snapshot?q="+$.now())}function q(a){function b(){e++;var a=1e3/u;if(1==e){var b=x();if(s.drawImage(f,0,0,b.width,b.height),f=null,1==c.isConnected)if(d>a)p();else{var g=a-d;window.setTimeout(function(){p()},g)}}}var d;new XMLHttpRequest;if(c.isConnected){var e=0,f=new Image,g=$.now();f.src=a,f.onload=function(){d=$.now()-g,v.width=f.width,v.height=f.height,b()},f.onerror=function(){p()}}}var r,s,t,u=1,v={width:640,height:480},w="http://localhost:16734";c.width=v.width,c.height=v.height,c.$on("$destroy",function(){c.isConnected=!1}),c.init=function(a){c.fidget=a,o(function(){t&&t(),r=document.getElementById("screen_"+a.id),s=r.getContext("2d"),t=c.$watchGroup([function(){return a.properties.width},function(){return a.properties.height},function(){return a.properties.source},function(){return a.properties.fps}],function(){var b=x();r.width=b.width,r.height=b.height,r.style.width=b.width+"px",r.style.height=b.height+"px",w=0==a.properties.source.indexOf("http://")?a.properties.source:"http://"+a.properties.source,u=a.properties.fps,c.remoteViewSize=b,c.margin={top:(c.fidget.properties.height-b.height)/2,left:(c.fidget.properties.width-b.width)/2}}),a.properties.onlyKeyboard&&(c.connect(),c.setKeyboardVisible(!0))},200)},c.$watch(function(){return l.loaded},function(){c.fidget&&c.init(l.getFidgetById(c.fidget.id))});var x=function(){var a=c.fidget,b=c.fidget.properties.width,e=c.fidget.properties.height;a.properties.fullScreen&&(b=d.innerWidth-120,e=d.innerHeight);var f,g,i=!0;v.width*e/v.height>b?(f=b,g=v.height*b/v.width):(g=e,f=v.width*e/v.height,i=!1);var j={width:f,height:g,top:i?(d.innerHeight-g)/2:0,left:i?0:(d.innerWidth-h.beltWidth-f)/2,fitWidth:i};return a.properties.fullScreen&&(a.properties.top=0,a.properties.left=0,a.properties.width=d.innerWidth-h.beltWidth,a.properties.height=d.innerHeight),j};c.isConnected=!1,c.connect=function(){c.isConnected=!0},c.$watchGroup([function(){return c.isConnected}],function(a){a&&p()}),c.disconnect=function(){c.isConnected=!1},c.isMenuVisible=!1,c.setMenuVisible=function(a){c.isMenuVisible=!c.isMenuVisible},window.onresize=function(a){c.setFullscreen(c.fidget.properties.fullScreen)},c.keyboard={size:{width:300,height:233},getHeight:function(){return.9*c.fidget.properties.height},getWidth:function(){return c.keyboard.size.width*(.9*c.fidget.properties.height)/c.keyboard.size.height},image:"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",clickToKey:function(a){var b=a.offsetX*c.keyboard.size.width/c.keyboard.getWidth(),d=a.offsetY*c.keyboard.size.height/c.keyboard.getHeight(),e=!1;c.keyboard.tapped&&(c.keyboard.tapped.key==y[0]&&(e=!0),window.clearTimeout(c.keyboard.tapped.timeout));for(var f,g=0;g<y.length;g++){var h=Math.sqrt(Math.pow(y[g].x-b,2)+Math.pow(y[g].y-d,2));(!f||f.distance>h)&&(f={distance:h,key:y[g]})}if(c.keyboard.tapped={x:f.key.x*c.keyboard.getWidth()/c.keyboard.size.width-35,y:f.key.y*c.keyboard.getHeight()/c.keyboard.size.height-35,key:f.key,color:f.key==y[0]?"rgba(200,0,0,0.7)":"rgba(0,200,0,0.7)",delay:16==f.key.keyCode?5e3:1e3},c.keyboard.tapped.timeout=window.setTimeout(function(){delete c.keyboard.tapped},c.keyboard.tapped.delay),f.key!=y[0]){var i={x:f.key.x,y:f.key.y,shift:e};$.get(w+"/keyPress",i)}}},c.isKeyboardVisible=!1,c.setKeyboardVisible=function(a){if(!a)return void(c.isKeyboardVisible=a);var b=new Image;b.src=w+"/keyboard",b.onload=function(){c.keyboard.size={width:b.width,height:b.height},c.isKeyboardVisible=a},c.keyboard.image=b.src},c.setFullscreen=function(a){var b=c.fidget;b.locked=a,null==b.properties.originalPosition||a!=b.properties.fullScreen&&a||(b.properties.width=b.properties.originalPosition.width,b.properties.height=b.properties.originalPosition.height,b.properties.top=b.properties.originalPosition.top||0,b.properties.left=b.properties.originalPosition.left||0),b.properties.fullScreen=a,a?(b.properties.originalPosition={height:b.properties.height,width:b.properties.width,top:b.properties.top||0,left:b.properties.left||0},b.properties.width=b.parent==l.currentScreen?$(window).width()-h.beltWidth:b.parent.properties.width,b.properties.width=b.parent==l.currentScreen?$(window).height():b.parent.properties.height,b.properties.top=0,b.properties.left=0,x()):b.originalPosition=null,c.fidget=b},c.isPressed=!1,c.onMouseEvent=function(a,b){if(0==a.button&&c.isConnected){var d=a.offsetX*c.width/c.fidget.properties.width,e=a.offsetY*c.height/c.fidget.properties.height;if((c.isPressed||"move"!=b)&&(c.isPressed||"release"!=b)&&("press"==b&&(c.isPressed=!0,pressPos={x:d,y:e}),"release"==b&&(c.isPressed=!1,Math.abs(pressPos.x-d)<5&&Math.abs(pressPos.y-e)<5))){var f={x:Math.floor(d),y:Math.floor(e)};$.get(w+"/click",f)}}};var y=[{x:29,y:26,keyCode:16,shiftedCode:null},{x:29,y:60,keyCode:17,shiftedCode:null},{x:98,y:33,keyCode:74,shiftedCode:null},{x:132,y:33,keyCode:76,shiftedCode:null},{x:166,y:33,keyCode:66,shiftedCode:null},{x:201,y:33,keyCode:80,shiftedCode:null},{x:236,y:33,keyCode:72,shiftedCode:null},{x:271,y:33,keyCode:9,shiftedCode:null},{x:254,y:78,keyCode:81,shiftedCode:null},{x:254,y:120,keyCode:87,shiftedCode:null},{x:46,y:179,keyCode:79,shiftedCode:null},{x:82,y:179,keyCode:55,shiftedCode:null},{x:116,y:179,keyCode:56,shiftedCode:null},{x:150,y:179,keyCode:57,shiftedCode:null},{x:185,y:179,keyCode:67,shiftedCode:null},{x:220,y:179,keyCode:78,shiftedCode:null},{x:253,y:179,keyCode:71,shiftedCode:null},{x:46,y:212,keyCode:73,shiftedCode:null},{x:82,y:212,keyCode:52,shiftedCode:null},{x:116,y:212,keyCode:53,shiftedCode:null},{x:150,y:212,keyCode:54,shiftedCode:null},{x:185,y:212,keyCode:77,shiftedCode:null},{x:220,y:212,keyCode:47,shiftedCode:null},{x:253,y:212,keyCode:68,shiftedCode:null},{x:46,y:247,keyCode:86,shiftedCode:null},{x:82,y:247,keyCode:49,shiftedCode:111},{x:116,y:247,keyCode:50,shiftedCode:106},{x:150,y:247,keyCode:51,shiftedCode:89},{x:185,y:247,keyCode:82,shiftedCode:null},{x:220,y:247,keyCode:83,shiftedCode:null},{x:253,y:254,keyCode:13,shiftedCode:null},{x:46,y:281,keyCode:65,shiftedCode:null},{x:82,y:281,keyCode:48,shiftedCode:107},{x:116,y:281,keyCode:110,shiftedCode:109},{x:150,y:281,keyCode:8,shiftedCode:90},{x:185,y:304,keyCode:37,shiftedCode:null},{x:220,y:281,keyCode:38,shiftedCode:null},{x:253,y:304,keyCode:39,shiftedCode:null},{x:220,y:315,keyCode:40,shiftedCode:null},{x:46,y:315,keyCode:84,shiftedCode:null},{x:82,y:315,keyCode:70,shiftedCode:null},{x:116,y:315,keyCode:69,shiftedCode:null},{x:150,y:315,keyCode:85,shiftedCode:null}]}remoteViewCtrl.$inject=["$http","$sce","$scope","$window","$location","$routeParams","$attrs","editorService","popupService","deviceService","scriptManagerService","projectService","variableService","settingsWindowService","$timeout"];